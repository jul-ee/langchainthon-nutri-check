# 💊 영양제 Check!

**“오늘은 무슨 영양제를 먹어야 하나?”**

넘쳐나는 정보 속에서 자신의 건강 상태와 복용 이력까지 고려한 믿을 만한 영양제를 찾기 어렵습니다.

**영양제 Check!** 는 사용자가 간단히

&nbsp;&nbsp;&nbsp;&nbsp;“ 질환·증상·특이사항 / 복용 중인 영양제·약품 / 원하는 영양제 특징” 을 입력하면

1. 학술 논문·가이드라인에서 검색한 근거 기반으로 “추천 / 피해야 할” 성분을 명확히 제시하고
2. 식약처 공공데이터 1 만 건에서 해당 성분을 포함하는 검증된 실제 제품을 추천합니다.

<div align="center">
    
![💊영양제 Check!](https://github.com/user-attachments/assets/9d613e6f-02d4-417e-bf7d-5fdbf009e9d1)

</div>

>프로젝트 기간: 2025.6.30 - 2025.07.03

> [데이터 출처]<br>
>
> **제품 정보**: &nbsp;[식품의약품안전처_건강기능식품정보](https://www.data.go.kr/data/15056760/openapi.do) 공공데이터 API  
> **학술 근거**: &nbsp;RAG 지식베이스로 사용한 논문·가이드라인 46편  

<br>
<br>

## README 목차

- [팀원 소개](#팀원-소개)
- [프로젝트 목표](#프로젝트-목표)
- [동작 프로세스](#동작-프로세스)
- [RAG 아키텍처](#rag-아키텍처)
- [주요 로직 & 설계 의도](#주요-로직--설계-의도)
- [개선 방향](#개선-방향)
- [폴더 구조](#폴더-구조)


<br>
<br>

## 팀원 소개

<div align="center">

| 손다혜 (팀장) | 고주리 | 김현민 | 채승희 |
| :--------------------------------------------------------------: | :--------------------------------------------------------------: | :--------------------------------------------------------------------------: | :-----------------------------------------------------------: |
| [@dahye4036](https://github.com/dahye4036)  | [@jul-ee](https://github.com/jul-ee) | [@meanstrel](https://github.com/meanstrel) | [@shchae12](https://github.com/shchae12) |
| ⸰ PM<br>⸰ 아이디어 기획<br>⸰ 기술 조사 | ⸰ 프롬프트 엔지니어링<br>⸰ 1차 RAG 설계<br>⸰ 응답 정밀도 개선 | ⸰ 학술 논문 조사<br>⸰ 문서 정제<br>⸰ 시나리오 기반 테스트 | ⸰ 공공데이터 파이프라인 구축<br>⸰ 2차 RAG 설계<br>⸰ 벡터 DB 구축 |

</div>

<br>
<br>

## 프로젝트 목표

1. **정보 신뢰도**
    - LLM 답변이 임의로 성분을 “창작”하지 않도록, 선행 연구·정부 지침이 포함된 PDF 근거만 이용  
      → 출처를 그대로 반환
2. **개인 맞춤**
    - 생활 습관·특정 질환 등 상호배타적 케이스(case A~D)를 미리 정의
    - 사용자의 라이프스타일을 분류해 처방을 다르게 제시
3. **실행 가능성**
    - “성분” 정보만으로 끝나지 않고, 식약처 OpenAPI에 등록된 실제 제품 제안·비교까지 바로 이어질 수 있게 함

<br>
<br>

## 동작 프로세스

1. **사용자 입력**
    
    > 나이·성별 / 질환·증상·특이사항 / 복용 중인 영양제·약품 / 원하는 영양제 특징
    > 
2. **카테고리 분류** *(사용자 입력 키워드 기반 → case A~D)*
3. **근거 문헌 검색 & LLM 분석**
    - 선택된 카테고리의 PDF > 문단 단위로 벡터화 > RAG
    - 프롬프트로 허용된 성분만 사용, 답변은 순수 JSON으로 제한
4. **제품 추천**
    - JSON 의 “recommended” 성분 → FAISS(식약처 10 k) 유사도 검색
    - “avoid” 성분이 포함된 제품은 실시간 필터링
5. **Streamlit UI 출력**
    - 대화형 카드로 추천·금기·주의·출처, 최종적으로 맞춤 영양제 제품 5종(상세 정보 포함) 제시

<br>
<br>

## RAG 아키텍처

![영양제Check_RAG_process](https://github.com/user-attachments/assets/c8ed6e81-2756-413e-9d65-91a1c81226e8)


<br>
<br>

## 주요 로직 & 설계 의도

#### 1. 근거 없는 LLM 환각 차단

- **RAG + 화이트리스트 프롬프트**
    
    검색된 문헌(학술 PDF·식약처 자료)만 LLM 컨텍스트로 주입하고, 답변에 쓸 수 있는 성분을 화이트리스트로 제한
    
    → “상상 속 성분”이 등장할 여지를 원천 봉쇄
    

#### 2. 사용자 상황별 케이스 분류 → 맞춤 처방

- `categorize_user_query()`에서 사용자 입력 키워드를 감지해 case A~D를 중첩 선택
- 프롬프트는 각 case의 JSON 템플릿을 그대로 이용하므로, 한 질문에 라이프스타일이 섞여도 처방이 정확히 달라짐

#### 3. 공공데이터 1,000 → 10,000 건 확장

> API 일일 호출 한도(10,000건)가 있어, 테스트 단계에서 페이지·배치 단위 최적화로 트래픽을 관리함

| 단계 | 시행착오 & 해결책 |
| --- | --- |
| ① 빠른 프로토타입: 1,000건 | - 식약처 API는 `numOfRows=100`이 최대<br>-5페이지(=500개)를 두 번 호출해 1,000개를 수집<br>- 1,000개를 한꺼번에 임베딩했더니 “토큰 초과 오류” 발생 |
| ② 토큰 초과 우회: 500 + 500 전략 | - 먼저 500개를 임베딩해 FAISS 초기 DB를 생성<br>- 이후 500개씩 추가 수집 → 100개 단위로 쪼개 임베딩 → DB에 `add_documents()` 로 누적 |
| ③ 전면 확장: 10,000건 | - 전체 100 페이지 × 100행 = 10,000건을 500개씩(5 페이지) 반복 수집<br>- 각 500개 블록을 다시 100개 단위로 분할 임베딩 후 DB에 추가<br>- 결과: 토큰 초과 없이 약 10 K 건 벡터 DB 완성, 쿼리 속도 ↓, 커버리지 ↑ |
| ④ 필요한 정보만 LangChain Document 변환 | 업체명·기능성·주의사항·섭취방법·표준성분만 필드로 남겨 임베딩 부담 최소화 |

#### 4. 다중 PDF + 대화 맥락 유지

- 카테고리별 벡터 DB를 `EnsembleRetriever` 로 묶어 recall을 높였고,
- `history-aware retriever`을 통한 직전 대화 재구성이 의미 있도록 확장 가능

#### 5. JSON 파싱 안전 장치

- “마크다운 금지, JSON only” 를 프롬프트에서 엄격히 요구
- `json.loads()` 실패 시 Streamlit이 즉시 경고해 UX 단절을 방지

#### 6. 실제 제품 연결 & 금기 성분 필터

- 추천 성분 → 10 K 벡터 DB 유사도 검색 → 피해야 할 성분이 포함된 제품은 실시간 제외
- 최종 5개만 노출하여 제품 비교 가능한 편리한 사용자 경험 제공

#### 7. 접근성 좋은 사용자 경험

- Streamlit form + chat + expander UI로, 입력 → 대답 → 근거 출처 → 제품 추천까지 한 화면에 제공
- 면책 고지를 하단에 상시 노출하여 의료적 혼동을 최소화함

<br>
<br>


## 개선 방향

>시연 이후 인사이트를 반영하여 개선 방향을 정리하였습니다.

본 프로젝트는 RAG를 두 단계로 구성하여 사용자 질문에 대한 질의응답과, 이후 조건 기반 영양제 추천까지 모두 언어 모델 기반 유사도 검색을 활용함. 그러나 성분 간 유사성이 높은 상황에서는 벡터 유사도 기반의 정렬이 기대만큼 명확한 우선순위를 제공하지 못할 가능성도 있음.

유사한 효능을 지닌 성분들이 다수 존재할 때, 유사도 기반 검색이 실제 추천의 우선순위와 다르게 작동할 수 있으며 이 경우 정형화된 구조의 RDB(Relational Database)를 활용한 정렬 방식이 더 효과적일 수 있음. 향후에는 RAG 기반 추천과 RDB 기반 정렬의 성능을 비교하여 추천 정확도 및 사용자 만족도를 기준으로 하이브리드 구조 도입도 고려할 수 있음.

또한 사용자에게 "추천 성분" 또는 "피해야 할 성분"을 제시할 때, 해당 내용을 뒷받침하는 연구 결과나 임상 근거(논문, 가이드라인 등)를 함께 제시하면 정보의 신뢰도와 전문성이 한층 높아질 수 있음. RAG의 응답 결과에 논문 출처 또는 핵심 문장을 인용하는 기능을 추가하거나, 근거 기반 요약 기능을 보완하는 방향으로도 개선이 가능함.


<br>
<br>

## 폴더 구조

```
📁 langchainthon-nutri-check/
│
├── 📁 data/                       # PDF 임베딩 전처리 및 저장
│   └── 📁 supplement_knowledge/
│       ├── 📁 case_A
│       ├── 📁 case_B
│       ├── 📁 case_C
│       └── 📁 case_D
│
├── 📁 docs/                       
│   └── 📄 REFERENCES.md           # RAG 학술 문헌 출처 명시
│
├── 📁 legacy/                     
│   ├── 📄 api_test.py             # 초기 테스트용 공공데이터 API 호출 (1,000건)
│   └── 📄 app_test.py             # 초기 테스트용 Streamlit 앱 실행 파일
│
├── 📄 api_final.py                # 최종 공공데이터 API 호출 (10,000건)
├── 📄 app_final.py                # 최종 Streamlit 앱 실행 파일
│
├── 📄 requirements.txt            # Python 패키지 명시
│
└── 📄 README.md
```

<br>

